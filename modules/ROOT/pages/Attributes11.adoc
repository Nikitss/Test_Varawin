= Variables (Переменные)
:doctype: book

[discrete]
==== Назначение:

Используются для установления и получения значений из объекта

image::values-title.png[]

[discrete]
==== Атрибуты:

[source,csharp]
----
    [Variable(English: "flame speed", Russian: "скорость горения")]
----

Атрибут помечает свойство (property) доступной для установки в GoogleBlockly.
Блоки установки или получения  значение переменной, будут зависить от её видимости (приватный или публичный доступ), написанный в коде объекта.
В передаваемых в атрибут параметрах мы указываем локализованный текст, который будет отображаться в блоке,  в зависимости от выбранного языка

[source,csharp]
----
    [VariableGroup("flames")]
----

Атрибут для включения переменной в группу блоков GoogleBlockly в разделе "`Переменные`".
Блоки с одинаковыми именами будут группироваться и отображаться в всплывающем списке (в примере с атрибутом указано  имя группы  "`flames`").
В случае не указания данного атрибута, блок не будет группироваться с другими, и останется отдельным элементом.

image::values-list-example.png[]

[discrete]
==== Пример кода объекта:

[source,csharp]
----
    [VariableGroup("flames")]
    [Variable(English: "flame speed", Russian: "скорость горения")]
    public float FlameSpeed
    {
        get => return _flameSpeed;
        private set => _flameSpeed = value;
    }
----

В данном примере создается блок только для получения значения.
Блок с заданием значения не создастся из за того,  что set для property является приватным.
Тип переменной является числом и может участвовать только  в математических блоках.

В следующем примере мы рассмотрим строковую переменную

[source,csharp]
----
    [VariableGroup("main texts")]
    [Variable(English: "text", Russian: "текст")]
    public string TextPanel
    {
        get => return _text;
        set => _text = value;
    }
----

Данная переменная будет участвовать только в строковых блоках

image::values-text-type.png[]

Аналогично можно создать переменную с булиевым типом, в результате получится блок, который будет учавствовать только в  логических блоках и будет выглядеть вот так:

image::values-bool-type.png[]

[discrete]
==== Примеры использования в GoogleBlockly

для чисел:

image::values-blockly-numeric-example.png[]

В данном примере выполняется следующая логика: Если объект 21, является игроком, то устанавливается значение переменной  "`скорость горения`" для объекта огонь 29, иначе увеличивается значение переменной onStreet на значение переменной  "`скорость горения`", полученной из объекта огонь 29

для строк

image::values-blockly-string-example.png[]

В данном примере выполняется следующая логика:

* для переменной "`текст`" объекта "`текстовая панель`" 81 устанавливаем текст "`Привет мир!!!`"
* устанавливаем значение переменной "`some text`" приведенную к заглавным буквам значение  переменной "`текст`"  объекта "`текстовая панель`" 81 (значение переменной будет "`ПРИВЕТ МИР!!!`")
* для переменной "`текст`" объекта "`текстовая панель`" 81 устанавливаем текст созданный из двух слов "`Скорость горения:`"  и приведенной к строке численной переменной "`скорость горения`" из объекта "`огонь 29`" (значение переменной будет  "`Скорость горения: Х`", (где X - значение переменной "`скорость горения`")

= Checker

image::checker-title.png[]

[discrete]
==== Назначение:

Используются для логических блоков в условиях.
Всегда имеет логический тип и возвращает правду или ложь (true or false)

[discrete]
==== Атрибуты:

[source,csharp]
----
    [Checker(English: "was the object dressed {0}", Russian: "был ли одет объект {0}")]
----

Атрибут помечает метод (method), возвращающий логический тип.
В передаваемых в атрибут параметрах мы указываем  локализованный текст, который будет отображаться в блоке, в зависимости от выбранного языка.
В фигурные скобки попадают входные параметры в порядке объявления, начиная с \{0}.

[source,csharp]
----
    [CheckerGroup("wear controls")]
----

Атрибут для включения checker в группу блоков GoogleBlockly в разделе "`Логика`".
Блоки с одинаковыми именами будут группироваться и отображаться в всплывающем списке (в примере с атрибутом указано  имя группы  "`wear controls`").
В случае не указания данного атрибута, блок не будет группироваться с другими,  и останется отдельным элементом

____
Можно группировать блоки, только с одинаковыми входными параметрами (количество и типы параметров должны быть идентичны)
____

[discrete]
==== Пример кода объекта:

[source,csharp]
----
    [CheckerGroup("wear controls)]
    [Checker(English: "was the object dressed {0}", Russian: "был ли одет объект {0}")]
    public bool IsPlayerDressObject(Wrapper wear)
    {
        return _wears[wear];
    }
----

В данном примере используется публичный метод, возвращающий булевое значение.
Данный блок мы расмотрим в следюущем примере.
Метод может содержать параметры, которые могут являтся любым из типов указанных [тут] +
//ToDo описать список типов входных параметров

[discrete]
==== Примеры использования в GoogleBlockly

image::checker-blockly-example.png[]

В данном примере реализована следующая логика: Если объект "контроллер одежды 187" вернёт правду, передавая ему объект 184, то установить объекту "реле 190" значение переменной "включён" объекта "реле 194"

== Action

image::action-title.png[]

[discrete]
==== Назначение:

Вызов методов у объектов.
С помощию actions можно задавать объекту определенное поведение, движение, изменение свойств и прочее.
По сути это может быть любой метод, который не подразумевает возвращаемое значение, проброшенный в GoogleBlockly.
Action может принимать неаграниченное количество параметров, которые могут являтся любым из типов указанных [тут]

[discrete]
==== Атрибуты:

[source,csharp]
----
    [Action(English: "add check  item text {0}", Russian: "добавить пункт текст {0}")]
----

Атрибут помечает метод (method), возвращающий void.
В передаваемых в атрибут параметрах мы указываем  локализованный текст, который будет отображаться в блоке, в зависимости от выбранного языка.
В фигурные скобки попадают входные параметры в порядке объявления, начиная с \{0}.

[source,csharp]
----
    [ActionGroup("devices")]
----

Атрибут для включения действия в группу блоков GoogleBlockly в разделе "`Действия`".
Блоки с одинаковыми именами будут группироваться и отображаться в всплывающем списке (в примере с атрибутом указано  имя группы  "`devices`").
В случае не указания данного атрибута, блок не будет группироваться с другими,  и останется отдельным элементом

____
Можно группировать блоки, только с одинаковыми входными параметрами (количество и типы параметров должны быть идентичны)
____

[discrete]
==== Пример кода объекта:

[source,csharp]
----
    [ActionGroup("devices")]
    [Action(English: "add check item text {0}", Russian: "добавить пункт текст {0}")]
    public void AddCheckItem(string text)
    {
        _checkItems.Add(text);
        _tablet.UpdateItemList(_checkItems);
    }
----

В данном примере используется публичный метод, возвращающий void.
Данный блок мы расмотрим в следюущем примере.
Метод может содержать параметры, которые могут являтся любым из типов указанных [тут]

[discrete]
==== Примеры использования в GoogleBlockly

image::action-blockly-example.png[]

В данном примере реализована следующая логика:

Если количество зафиксированных нарушений в объекте "планшет 61" меньше пяти, то:

* очистить все пункты в объекте "планшет 61"
* добавить новый пункт с текстом "Cфотографировать 5 нарушений" в объекте "планшет 61"
* отправить сообщение в объект "планшет 61" с текстом: "Добавлено новое задание!
Прочтите его в чеклисте.
Вы уже зафиксировали X из 5 нарушений"  (где X - значение переменной "количество зафиксированный нарушений" в объекте "планшет 61")

Иначе (если количество зафиксированных нарушений в объекте "планшет 61" больше или равно пяти)

* отправить сообщение в объект "планшет 61" с текстом: "Сообщите о зафиксированных нарушениях начальнику смены"

= Function

image::function-title.png[]

[discrete]
==== Назначение:

Вызов методов у объектов, с целью получения значения.
Имеет такой же функционал что и у действий, только с  возвращаемым значением.

[discrete]
==== Атрибуты:

[source,csharp]
----
    [Function(English: "sum of {0} and {1}", Russian: "сложить {0} и {1}")]
----

Атрибут помечает метод (method), который возвращает значение.
В передаваемых в атрибут параметрах мы указываем  локализованный текст, который будет отображаться в блоке, в зависимости от выбранного языка.
В фигурные скобки попадают входные параметры в порядке объявления, начиная с \{0}.

[source,csharp]
----
    [FunctionGroup("math")]
----

Атрибут для включения функции в группу блоков GoogleBlockly в разделе "`Функции`".
Блоки с одинаковыми именами будут группироваться и отображаться в всплывающем списке (в примере с атрибутом указано  имя группы  "`math`").
В случае не указания данного атрибута, блок не будет группироваться с другими,  и останется отдельным элементом

____
Можно группировать блоки, только с одинаковыми входными параметрами (количество и типы параметров должны быть идентичны)
____

[discrete]
==== Пример кода объекта:

[source,csharp]
----
    [FunctionGroup("math")]
    [Function(English: "sum of {0} and {1}", Russian: "сложить {0} и {1}")]
    public float Sum(float a, float b)
    {
        return a + b;
    }
----

[discrete]
==== Примеры использования в GoogleBlockly

____
В разработке
____

== Events

image::event-title.png[]

[discrete]
==== Назначение:

События используются тогда, когда не нужно проверять что либо каждый кадр, а нужно сделать подписку на  какое либо действие, которое случилось с объектом.
+ Например:

* кнопку нажали
* объект упал на землю
* надели экипировку
* и т.д.

При срабатывании события выполняются блоки, помещенные внутрь блока события

[discrete]
==== Атрибуты:

[source,csharp]
----
    [Event(English: "on wear dressed", Russian: "на одевание одежды")]
----

Атрибут помечает событие (event).
В передаваемых в атрибут параметрах мы указываем  локализованный текст, который будет отображаться в блоке, в зависимости от выбранного языка.
В фигурные скобки попадают входные параметры делегата в порядке объявления, начиная с \{0}.

[source,csharp]
----
    [EventGroup("dress events")]
----

Атрибут для включения события в группу блоков GoogleBlockly в разделе "`События`".
Блоки с одинаковыми именами будут группироваться и отображаться в всплывающем списке (в примере с атрибутом указано  имя группы  "`dress events`").
В случае не указания данного атрибута, блок не будет группироваться с другими,  и останется отдельным элементом

____
Можно группировать блоки, только с одинаковыми входными параметрами делегата (количество и типы параметров должны  быть идентичны)
____

[discrete]
==== Пример кода объекта:

[source,csharp]
----

    public delegate void DressWearHandler(Wrapper wear);

    [EventGroup("dress events")]
    [Event(English: "on wear dressed", Russian: "на одевание одежды")]
    public event DressWearHandler WearDressed;

    protected virtual void OnWearDressed(Wrapper wear)
    {
        WearDressed?.Invoke(wear);
    }
----

В данном примере мы объявляем делегат DressWearHandler принимающий параметр wear типа Wrapper.
Далее объявляем событие WearDressed на DressWearHandler.
Метод OnWearDressed(Wrapper wear) планируем вызывать когда игрок надевает одежду.
Он и будет вызывать событие, которое проброшено в GoogleBlockly.
Пример блока расмотрим далее.

[discrete]
==== Примеры использования в GoogleBlockly

image::event-blockly-example.png[]

В данном примере отрабатывается следующая логика:

* В момент инизиализации мира создаём пустой список с именем "playerWear"
* Когда игрок одевает одежду (переменная "wear", приходит из объекта "контроллер одежды") :
 ** Если одеваемая одежда является типом куртка, то присваиваем текст для переменной playerMessage    "Вы надели куртку!
Защита от порезов увеличена"
 ** Если одеваемая одежда является типом противогаз, то присваиваем текст для переменной playerMessage    "Вы надели противогаз!
Защита от ядовитых газов увеличена"
 ** Добавляем в список "playerWear" новый элемент wear
